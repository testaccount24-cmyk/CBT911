**** SUBJCL1 REXX Program. ****

/* REXX SUBJCL1
   SUBMITTING JCL FOR BATCH PROCESSING.
   INSERTING VARIABLE VALUES INTO THE JCL
   USING THE INTERNAL DATA QUEUE

   QUEUE LINES OF JCL, THEN WRITE TO A FILE
   FROM THE DATA QUEUE.
   SUBMIT THE FILE, THEN DELETE IT
*/

TEMP_FILE_NAME = "'userid.TEMP.SUBMIT.CNTL'"
PROGRAM_TO_EXECUTE = "MYPROG1"

CALL MSG "OFF"
"DELETE" TEMP_FILE_NAME
CALL MSG "ON"

SIGNAL ON ERROR
"ALLOC DDN(TEMPFILE) NEW REUSE DSN("TEMP_FILE_NAME")",
   "SPACE(3,1) TRACKS"
SIGNAL OFF ERROR

"NEWSTACK"
QUEUE "//useridA  JOB (0),'TSO USER',"
QUEUE "//         TYPRUN=SCAN,  "
QUEUE "//         MSGLEVEL=1,CLASS=A,NOTIFY=userid"
QUEUE "//STEP1    EXEC PGM="PROGRAM_TO_EXECUTE
QUEUE "//INFILE   DD DSN=userid.INPUT.FILE,DISP=SHR "
QUEUE "//OUTFILE  DD SYSOUT=A "
QUEUE "//SYSIN    DD * "
QUEUE DATE() TIME()
QUEUE "/*"


"EXECIO" QUEUED() "DISKW TEMPFILE (FINIS)"
"DELSTACK"
"FREE DDNAME(TEMPFILE)"
"SUBMIT" TEMP_FILE_NAME
CALL MSG "OFF"
"DELETE" TEMP_FILE_NAME
CALL MSG "ON"
EXIT

ERROR:
SAY "UNABLE TO ALLOCATE TEMPORARY FILE" TEMP_FILE_NAME
SAY "TERMINATING"
EXIT

